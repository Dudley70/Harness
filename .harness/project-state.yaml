# Harness Project State
# This file is the FIRST thing loaded in any session
# Last Updated: 2025-12-13 (session 8)

project:
  name: Harness
  description: "AI-Native Development Methodology - Channeling AI power through human-designed controls"
  repository: https://github.com/Dudley70/Harness
  created: 2025-12-10

current_phase: Architecture-Design

current_focus:
  task: "Skills-based context system design"
  status: architecture_decided
  details: "D12 approved: Harness replaces BMAD with Skills-based architecture. Ready to prototype."

# Session History
# NOTE: "Sessions" here are substantive WORK sessions (human-numbered 1, 2, 3...)
# The system also has 16+ TRANSCRIPTS (every time SessionStart hook fired).
# Transcripts include micro-tests, debug sessions, etc.
# Use atoms.jsonl to query all transcripts; use this file for work session summaries.
sessions:
  session_1:
    date: 2025-12-10
    ended_at_context: "83% (166k/200k) - RED zone, session ended proactively"
    key_accomplishments:
      - "Project initialized with governance structure"
      - "Working agreement with validated sub-agent learnings"
      - "Vision document created (at 102% - emergency capture)"
      - "Lean research: 23 patterns extracted"
    lessons_learned:
      - "L1: Sub-agent output MUST write to files"
      - "L2: State docs capture WHAT not WHY"
      - "L3: 'Documented everything' is dangerous assumption"
      - "L4: Emergency captures indicate process failure"

  session_2:
    date: 2025-12-10
    focus: "Transcript analysis and capture protocol"
    key_accomplishments:
      - "Discovered sessions persist to ~/.claude/projects/ as JSONL"
      - "Session 1 transcript (166KB) recovered and analyzed"
      - "Gap analysis: identified undocumented insights from transcript"
      - "Created Capture & Documentation Protocol"
      - "Updated working-agreement with Claude Code vs Desktop comparison"
      - "Embedded capture as CORE methodology requirement"
    key_decisions:
      - "D7: Transcripts are essential memory - must be captured"
      - "D8: End-of-session checklist is MANDATORY"
      - "D9: Capture protocol is foundation of Harness, not add-on"
    new_learnings:
      - "JSONL sessions contain ~7x more than readable markdown"
      - "Human-readable content: ~128KB; Tool overhead: ~397KB"
      - "Claude Desktop history survives CLI reset"
      - "Transcript mining can recover undocumented insights"

  session_3:
    date: 2025-12-11
    focus: "Recovery system enhancement and document governance"
    key_accomplishments:
      - "Enhanced session-recovery.py with progressive disclosure format"
      - "Added session profile, files touched, priority checklist to transcripts"
      - "BMAD Master updated with recovery-check, deep-recovery, run-recovery menus"
      - "Created document-index.md defining document purposes"
      - "Removed duplication: working-agreement.md now references vision.md"
      - "Added decision-sync check to recovery script"
      - "Synced vision.md with Session 2 & 3 principles"
    key_decisions:
      - "D10: Recovery Handoff Protocol - hook lightweight, Master does full restore"
      - "D11: BMAD Master as default entry point for all interactions"
      - "D12: Each document has ONE purpose, no duplication"
    new_learnings:
      - "Claude Code hooks: SessionStart, SessionEnd, Stop, PreCompact, PostToolUse available"
      - "Party mode loads ALL agent personas (~4,500 tokens) - sunk cost once loaded"
      - "PostToolUse can target specific file edits (Edit|Write matcher)"
      - "Single JSONL per project, cumulative across sessions"
    context_at_end: "82% - ORANGE zone"

  session_4:
    date: 2025-12-11
    focus: "Persistent context architecture research and design"
    key_accomplishments:
      - "Fixed SessionStart hook for worktrees (moved to global ~/.claude/settings.json)"
      - "Diagnosed recovery system - hook works but only bridges to NEXT session"
      - "Researched 6 Anthropic sources on context management patterns"
      - "Discovered Skills as native progressive disclosure mechanism"
      - "Analyzed claude-code-bmad-skills repo (helpers.md pattern)"
      - "Made D12: Harness replaces BMAD, built on Skills architecture"
      - "Created patterns-and-ideas.md for capturing research"
    key_decisions:
      - "D12: Harness Architectural Foundation - Skills-based context system"
    new_learnings:
      - "CLAUDE.md auto-loaded (native memory hierarchy)"
      - "Skills = progressive disclosure + model-invoked discovery"
      - "helpers.md pattern: 70-85% token savings via section references"
      - "Level-based methodology: right-size for project complexity"
      - "7-step init ritual from Anthropic autonomous-coding"
      - "JSON > YAML/MD for state (less corruption per Anthropic)"
      - "Fresh context > compaction (Claude 4.5 excels at filesystem discovery)"
      - "Two-agent pattern: Initializer (plans) + Coding Agent (executes)"
    sources_researched:
      - "https://code.claude.com/docs/en/skills"
      - "https://anthropic.com/engineering/effective-harnesses-for-long-running-agents"
      - "https://platform.claude.com/docs/en/build-with-claude/prompt-engineering/claude-4-best-practices"
      - "https://github.com/anthropics/claude-quickstarts/tree/main/autonomous-coding"
      - "https://anthropic.com/engineering/advanced-tool-use"
      - "https://github.com/aj-geddes/claude-code-bmad-skills"
    context_at_end: "81% - ORANGE zone"

  session_5:
    date: 2025-12-12
    focus: "Knowledge extraction system - taxonomy, atoms, retrospective"
    key_accomplishments:
      - "Reviewed all 16 session transcripts systematically"
      - "Created taxonomy.yaml - 10 core types, 5 domain types, DIKW maturity model"
      - "Built extract-atoms.py - processes transcripts to atoms.jsonl"
      - "Extracted 267 atoms from historical sessions"
      - "Updated vision.md - corrected Harness positioning (NOT child of BMAD)"
      - "Created ideas.yaml (8 ideas) and questions.yaml (10 questions)"
      - "Documented retrospective process in .harness/docs/"
      - "Captured 8 open questions (Q1-Q8) for future sessions"
    key_decisions:
      - "Atoms are the knowledge unit (not sessions)"
      - "Multi-type classification (atoms can have multiple types)"
      - "DIKW maturity model: extracted → synthesized → principled"
      - "RESEARCH promoted from domain to core type"
    new_learnings:
      - "Session classification types: MICRO_TEST, DEBUG, DEVOPS, RESEARCH, WORK, DISCUSSION"
      - "Types = structural (what kind), Keywords = content (what about)"
      - "Ideas/questions need lifecycle tracking (captured → exploring → promoted)"
      - "Context is not linear - autocompact frees space as you go"
    files_created:
      - ".harness/taxonomy.yaml"
      - ".harness/scripts/extract-atoms.py"
      - ".harness/atoms.jsonl"
      - ".harness/ideas.yaml"
      - ".harness/questions.yaml"
      - ".harness/docs/retrospective-process.md"
    context_at_end: "95% - RED zone"

  session_6:
    date: 2025-12-12
    focus: "Git health check, CLAUDE.md design, progressive disclosure"
    key_accomplishments:
      - "Created PROJECT-MAP.md - orientation layer for progressive disclosure"
      - "Created journal/ structure with README for session narratives"
      - "Git cleanup - merged 2 branches (unruffled-cerf, bold-jemison) to main"
      - "Deleted 7 stale worktrees/branches"
      - "Added git health check to session-recovery.py with visual status table"
      - "Added actionable suggestions to git health output"
      - "Created CLAUDE.md via /init, then trimmed from 227→116 lines"
      - "Added Session Greeting format to CLAUDE.md"
      - "Reviewed Anthropic CLAUDE.md best practices documentation"
      - "Party mode brainstorm on CLAUDE.md structure and progressive disclosure"
    key_decisions:
      - "CLAUDE.md = instructions not information (reference, don't embed)"
      - "Subfolder CLAUDE.md for domain-specific context (to explore)"
      - "Skills research (Superpowers) needed before implementing Skills"
    new_learnings:
      - "CLAUDE.md cascades: global → project → subfolder (on-demand)"
      - "CLAUDE.local.md for personal prefs (gitignored)"
      - "Press # during session to add learnings to CLAUDE.md"
      - "Git worktrees can't delete branches while checked out"
      - "Merge conflicts from amending already-merged commits"
    files_created:
      - ".harness/PROJECT-MAP.md"
      - ".harness/journal/README.md"
      - ".harness/templates/session-journal.md"
      - ".harness/reference/CLAUDE-init-full.md"
      - "CLAUDE.md (project root)"
    context_at_end: "~90% - RED zone"

  session_7:
    date: 2025-12-12
    focus: "Skills architecture research and D13/D14 decisions"
    key_accomplishments:
      - "CLAUDE.md enhanced: Scripts, Knowledge Base, Troubleshooting, BMAD agents"
      - "D13: Harness-native config (.harness/project.yaml + symlinks)"
      - "D14: Skills as Universal Progressive Disclosure Architecture"
      - "Created .claude/skills/harness/ with SKILL.md + index.md"
      - "Fixed bmad-master.agent.yaml config reference"
      - "Researched: Superpowers, Anthropic docs, claude-code-bmad-skills"
      - "Git cleanup: pushed cranky-hertz, deleted bold-jemison"
      - "Vision.md synced with D13 principles"
      - "Party mode discussion on skills ideation"
    key_decisions:
      - "D13: .harness/project.yaml as single source of truth"
      - "D14: All capabilities become Skills (personas, workflows, toolbox, knowledge)"
      - "helpers.md pattern for 70-85% token savings"
    new_learnings:
      - "Skills are model-invoked, not user-invoked"
      - "Description field triggers activation ('Use when...')"
      - "Personas fade in long sessions - design for ephemeral context"
      - "helpers.md with section references eliminates duplication"
      - "Superpowers: 20 focused skills, verb-first naming, flat structure"
      - "Q6 answered: Skills ARE the unified architecture"
    files_created:
      - ".harness/project.yaml"
      - ".claude/skills/harness/SKILL.md"
      - ".claude/skills/harness/index.md"
      - ".bmad/core/config.yaml (symlink)"
    context_at_end: "~82% - RED zone"

  session_8:
    date: 2025-12-13
    focus: "Document Integrity Infrastructure (D15, D16, D17)"
    key_accomplishments:
      # Git cleanup
      - "Git cleanup: merged cranky-hertz (+6) and silly-proskuriakova (+1) to main"
      - "Gitignored .harness/hook-test.log and recovery-state.json (prevent merge conflicts)"
      # BMAD Independence (D15)
      - "Diagnosed BMAD party-mode failure (missing _cfg/agent-manifest.csv)"
      - "D15: Entry Points, Menu Navigation, BMAD Independence"
      # Document Integrity (D16) - CRITICAL
      - "Discovered 26 task items silently deleted across Sessions 4-8"
      - "Created document-controls.yaml - registry/schema for all files"
      - "Created validate-integrity.py - config-driven validation"
      - "Installed pre-commit hook - mechanical enforcement"
      - "Restored all 12 lost task items from git history"
      - "L5: Task Lists are Append-Only (lesson captured)"
      # Document Management Skill
      - "Created .claude/skills/harness/document-management/ skill"
      - "SKILL.md, lifecycle.md, registration.md for progressive disclosure"
      - "Added PyYAML to requirements.txt"
      - "Updated CLAUDE.md with Document Integrity section"
      # Document Structure (D17) - Design only
      - "D17: Designed location rules + registration enforcement"
      - "D17: Designed PostToolUse hook for real-time validation"
    key_decisions:
      - "D15: Single /harness entry point with internal menus"
      - "D15: BMAD as reference material only, no runtime dependency"
      - "D16: Document Integrity as Core Infrastructure"
      - "D16: Files ARE the memory - corruption = system failure"
      - "D16: All files registered in document-controls.yaml"
      - "D17: Location rules - every content type has a home"
      - "D17: Registration enforcement - every home on the map"
      - "D17: PostToolUse hook for real-time validation (design)"
    new_learnings:
      - "BMAD requires installer to generate manifest - heavy infrastructure"
      - "State files cause merge conflicts across worktrees - gitignore them"
      - "AI silently deletes content without asking - mechanical enforcement required"
      - "Commit-time validation isn't enough - need real-time (PostToolUse)"
      - "Document management is a skill - operational knowledge"
      - "Progressive disclosure: CLAUDE.md → PROJECT-MAP.md → document-controls.yaml → files"
    files_created:
      - ".harness/document-controls.yaml"
      - ".harness/scripts/validate-integrity.py"
      - ".harness/hooks/pre-commit"
      - ".claude/skills/harness/document-management/SKILL.md"
      - ".claude/skills/harness/document-management/lifecycle.md"
      - ".claude/skills/harness/document-management/registration.md"
      - "requirements.txt"
    context_at_end: "89% - RED zone"

blockers: []

next_session_actions:
  # ============================================
  # RULES: Append-only. Mark DONE/OBSOLETE, never delete.
  # ============================================

  # Session 9 - OPEN ITEMS (flagged at session end)
  - "P1: Merge confident-benz to main (again) - now +6 commits ahead"
  - "P1: Test /harness command - created but never tested"
  - "P2: Answer: Should session summaries be immutable once written?"
  - "P1: Update PROJECT-MAP.md with new files (D15, D17 additions)"
  - "P1: Investigate /refresh command not appearing - file exists but not in Available Commands"

  # Session 9 additions - Skill Invocation Architecture Research
  - "P0: Research skill invocation architecture (Q9-Q37 in questions.yaml)"
  - "P0: Use claude-code-guide agent to answer Claude Code specific questions"
  - "P1: Synthesize research into D18: Skill Invocation Architecture decision"
  - "P1: Implement IDEA-009 based on D18 findings (session lifecycle / pre-pivot)"
  - "P1: Implement IDEA-010 - question/task tracking mechanism"

  # Session 8 additions (D17 - Document Structure Implementation)
  - "DONE: Implement D17 - Add locations: section to document-controls.yaml (Session 9)"
  - "DONE: Implement D17 - Add registration: section to document-controls.yaml (Session 9)"
  - "DONE: Implement D17 - Add --realtime mode to validate-integrity.py (Session 9)"
  - "DONE: Implement D17 - Add PostToolUse hook to settings.json (Session 9)"
  - "DONE: Implement D17 - Add check_content_location() function (Session 9)"
  - "DONE: Implement D17 - Add check_registration() function (Session 9)"
  - "P1: Update PROJECT-MAP.md with any missing files"
  - "DONE: Test D17 end-to-end validation (Session 9)"

  # Session 8 additions (D15)
  - "DONE: Create /harness entry point command (.claude/commands/harness.md) (Session 9)"
  - "DONE: Build first agent (analyst.md) in .claude/skills/harness/agents/ (Session 9)"
  - "DONE: Build party workflow (.claude/skills/harness/workflows/party.md) (Session 9)"
  - "P1: Test menu-based navigation flow"
  - "DONE: Build 2-3 more agents (architect, pm, dev) (Session 9)"

  # Carried forward from Session 7
  - "P0: Create helpers.md with shared operations"
  - "P0: Build first persona skill (persona-pm)"
  - "P0: Build first workflow skill (capturing-decisions)"
  - "P1: Test model invocation of skills"
  - "P1: Integrate atom extraction into SessionStart hook"
  - "P1: Prototype visualization (Q3 - mind map from atoms)"
  - "P1: Prototype Harness skill structure (.claude/skills/harness/)"
  - "P2: Consolidate Sessions 1-3 learnings into patterns-and-ideas.md"
  - "P2: Build query tool for atoms (beyond manual Python)"

  # RECOVERED FROM GIT HISTORY (Session 8 audit)
  - "P0: Create SKILL.md with init ritual and routing logic"
  - "P0: Define standard document template with progressive disclosure structure"
  - "P0: Design Harness information architecture (sitemap/master index for LLM navigation)"
  - "P1: Address Q1-Q8 from questions.yaml (pick highest value)"
  - "P1: Create research plan document with methodology assignments"
  - "P1: Define Pattern Extraction Schema for methodology research"
  - "P1: Git/GitHub management UX - guided workflows, auto-push (partial: health check done)"
  - "P1: Migrate state files to JSON format (project-state, task-list)"
  - "P2: Begin methodology research (sub-agents write directly to files)"
  - "P2: Consider PreCompact/SessionEnd hooks setup"
  - "P2: Document Harness methodology (replacing BMAD methodology)"
  - "P2: Migrate valuable BMAD patterns to new architecture"

  # Status updates
  - "DONE: Merge cranky-hertz to main (Session 8)"
  - "DONE: Deep dive Superpowers repo (Session 7 - see D14)"
  - "DONE: Merge silly-proskuriakova to main (Session 8)"
  - "PARKED: LLM-optimized document format - see /Users/dudley/projects/Compression/"

improvement_ideas:
  git_github_ux:
    problem: "Easy to forget push, hard to see branch state, no guided workflow"
    status: "IMPLEMENTED in Session 6"
    implemented:
      - "Visual git health check in session-recovery.py"
      - "Shows branches, worktrees, uncommitted changes"
      - "Actionable suggestions (what commands to run)"
    remaining:
      - "Guided workflow for PR creation (future)"
      - "Human-readable status summary (not just git output)"
      - "Auto-push option on session end (SessionEnd hook?)"
      - "Branch management guidance (when to branch, when to merge)"
    possible_approaches:
      - "BMAD Master 'git-status' menu item with formatted output"
      - "SessionEnd hook that shows status + prompts for push"
      - "Custom script that renders visual branch tree"
      - "Integration with gh CLI for PR status"

parked_research:
  llm_compression:
    location: "/Users/dudley/projects/Compression/"
    key_file: "readme.md"
    status: "Completed project from earlier - needs thorough testing before use"
    note: "User's first Claude Code skill - may need updates for current environment"
    relevance: "77% compression with 100% sacred content preservation"
    key_insights:
      - "Pure LLM compression failed 5/5 times - architectural separation required"
      - "Sacred content (code, formulas, prompts) physically extracted before LLM processing"
      - "Placeholder system: {{SACRED_TEST_PROMPT_0}} preserves references"
      - "Hybrid pipeline: Extract → LLM compress → Restore → Validate"
      - "Principle: Structure prevents loss, not prompts or discipline"
    harness_application:
      - "Context anchors = sacred content (NEVER compress)"
      - "Progressive disclosure = hybrid pipeline layers"
      - "Document structure could use placeholder/reference patterns"
      - "V7 abbreviation rules for LLM-optimized format"

files_created_session_3:
  - "00-governance/document-index.md"
  - ".harness/transcripts/auto-recovery-*.md (multiple)"
  - "Enhanced: .harness/scripts/session-recovery.py"
  - "Enhanced: .bmad/core/agents/bmad-master.agent.yaml"
  - "Updated: 00-governance/vision.md (Session 2 & 3 principles)"
  - "Updated: 00-governance/working-agreement.md (removed duplication)"

files_created_session_2:
  - ".harness/transcripts/session1-transcript.md"
  - ".harness/scripts/analyze-session.py"
  - "00-governance/capture-protocol.md"
  - "00-governance/working-agreement.md (updated with transcript insights)"

key_documents:
  always_load:
    - ".harness/project-state.yaml"
  governance:
    - "00-governance/vision.md"
    - "00-governance/working-agreement.md"
    - "00-governance/capture-protocol.md"
    - "00-governance/document-index.md"
  reference:
    - ".harness/decision-log.md"
    - ".harness/lessons-learned.md"
    - ".harness/patterns-and-ideas.md"
  scripts:
    - ".harness/scripts/session-recovery.py"
  transcripts:
    - ".harness/transcripts/ (auto-recovery files)"

files_created_session_4:
  - ".harness/patterns-and-ideas.md"
  - "Updated: .harness/decision-log.md (D12)"
  - "Updated: ~/.claude/settings.json (global hook)"

recovery_instructions: |
  NEXT SESSION START:
  1. Read this file first (you're doing it!)
  2. Read 00-governance/working-agreement.md for process
  3. Read 00-governance/capture-protocol.md for documentation rules
  4. Run /context to check starting budget
  5. Continue with next_session_actions above

  END OF SESSION:
  1. Run End-of-Session Checklist (see capture-protocol.md)
  2. Export transcript to .harness/transcripts/
  3. Update this file with session summary
  4. Commit all changes
