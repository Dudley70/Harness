#!/bin/bash
# Pre-commit hook: Validate document integrity
# Install: ln -sf ../../.harness/hooks/pre-commit .git/hooks/pre-commit
#
# This hook enforces document integrity rules defined in:
#   .harness/document-controls.yaml
#
# See Decision #16 in decision-log.md for rationale.

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"

# Run the integrity validation script
python3 "$PROJECT_ROOT/.harness/scripts/validate-integrity.py"
exit_code=$?

if [ $exit_code -ne 0 ]; then
    echo ""
    echo "╔════════════════════════════════════════════════════════╗"
    echo "║  COMMIT BLOCKED - Document Integrity Violation         ║"
    echo "╠════════════════════════════════════════════════════════╣"
    echo "║  Files ARE the memory. Memory corruption = failure.    ║"
    echo "║                                                        ║"
    echo "║  See: .harness/document-controls.yaml                  ║"
    echo "║  See: Decision #16 in decision-log.md                  ║"
    echo "╚════════════════════════════════════════════════════════╝"
    exit 1
fi

exit 0
